<div class="small-12 large-10 columns nopadding ticketContent" ng-controller="reportsCtrl">
    <div class="page-title noshadow">
        <p class="left">{{title}}</p>
        <div class="right clearfix" style="min-width: 250px;">
            <div class="md-fab-wrapper">
                <div class="md-fab md-fab-toolbar md-fab-small md-fab-accent">
                    <i class="material-icons" style="color: white">&#xE8BE;</i>
                    <div class="md-fab-toolbar-actions">
                        <button type="submit" id="user_edit_save" data-uk-tooltip="{cls:'uk-tooltip-small',pos:'bottom'}" title="Save"><i class="material-icons md-color-white">&#xE161;</i></button>
                        <button type="submit" id="user_edit_print" data-uk-tooltip="{cls:'uk-tooltip-small',pos:'bottom'}" title="Print"><i class="material-icons md-color-white">&#xE555;</i></button>
                        <button type="submit" id="user_edit_delete" data-uk-tooltip="{cls:'uk-tooltip-small',pos:'bottom'}" title="Delete"><i class="material-icons md-color-white">&#xE872;</i></button>
                    </div>
                </div>
            </div>
            <div style="margin-top: 8px;">
                <select id="select_timespan" name="select_timespan" data-md-selectize>
                    <option value="30" selected>Last 30 Days</option>
                    <option value="60">Last 60 Days</option>
                    <option value="90">Last 90 Days</option>
                    <option value="180">Last 180 Days</option>
                    <option value="365">Last 365 Days</option>
                </select>
            </div>
            <ul class="button-group">
                <!--<li style="position: relative;">-->
                    <!--<div style="margin-top: 20px; margin-right: 5px;">-->
                        <!--<select name="range" id="range" class="chosen-select">-->
                            <!--<option value="30">Last 30 Days</option>-->
                            <!--<option value="60">Last 60 Days</option>-->
                            <!--<option value="90">Last 90 Days</option>-->
                            <!--<option value="180">Last 180 Days</option>-->
                            <!--<option value="365">Last 365 Days</option>-->
                        <!--</select>-->
                    <!--</div>-->
                <!--</li>-->
            </ul>
        </div>

        <div id="lastUpdated" class="right uk-text-muted uk-text-small" style="margin:23px 25px 0 0;"><strong>Last Updated:</strong> <span>2-17-2016 07:55:55pm</span></div>
    </div>

    <div class="full-height page-right-content scrollable">

        <div style="margin-top: 20px;">
            <div class="small-12 columns nopadding">
                <div class="small-4 columns">
                    <div class="panel trupanel nopadding tru-card-intro" style="min-height: 85px;">
                        <div class="tru-card-content">
                            <div class="right uk-margin-top uk-margin-small-right">
                                <span class="peity-bar">5,3,9,6,5,9,7</span>
                            </div>
                            <span class="uk-text-muted uk-text-small">Total Tickets (last 30d)</span>
                            <h2 class="uk-margin-remove">
                                <span id="ticketCount" class="countUpMe">899</span>
                            </h2>
                        </div>

                    </div>
                </div>
                <div class="small-4 columns">
                    <div class="panel trupanel nopadding tru-card-intro" style="min-height: 85px;">
                        <div class="tru-card-content">
                            <div class="right uk-margin-top ukmargin-small-right">
                                <span id="pie_complete" class="peity-pie">64/100</span>
                            </div>
                            <span class="uk-text-muted uk-text-small">Tickets Completed</span>
                            <h2 class="uk-margin-remove">
                                <span id="text_complete" class="countUpMe">64</span>%
                            </h2>
                        </div>
                    </div>
                </div>
                <div class="small-4 columns">
                    <div class="panel trupanel nopadding tru-card-intro" style="min-height: 85px;">
                        <div class="tru-card-content">
                            <div class="right uk-margin-top ukmargin-small-right">
                                <span id="responseTime_graph" class="peity-line">5,3,9,6,5,9,7,3,5,2</span>
                            </div>
                            <span class="uk-text-muted uk-text-small">Avg Response Time</span>
                            <h2 class="uk-margin-remove">
                                <span id="responseTime_text" class="countUpMe">34</span> hours
                            </h2>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="small-12 columns">

            <div class="panel trupanel nopadding no-hover-shadow" style="min-height: 300px;">
                <div class="left">
                    <h6 style="padding: 15px; margin: 0; font-size: 14px;">Ticket Breakdown</h6>
                </div>
                <div class="right" style="position:relative;">
                    <button class="action-link"><i class="material-icons">refresh</i></button>
                    <div class="right" data-uk-dropdown="{pos: 'bottom-right'}" aria-haspopup="true" aria-expanded="false">
                        <button class="action-link"><i class="material-icons">more_vert</i></button>
                        <div class="uk-dropdown uk-dropdown-small uk-dropdown-bottom">
                            <ul class="uk-nav">
                                <li><a href="/tickets">This is a Link</a></li>
                                <li><a href="#">This is a Link</a></li>
                                <li><a href="#">This is a Link</a></li>
                            </ul>
                        </div>

                    </div>
                </div>
                <hr class="nomargin-top">
                <div class="panel-body2">
                    <div id="test" class="mGraph mGraph-panel graph-blue1">

                    </div>
                </div>
            </div>
        </div>
        <div class="small-12 columns nopadding">
            <div class="small-3 columns">
                <div class="panel trupanel nopadding">
                    <div class="tru-card tru-card-overlay">
                        <div class="tru-card-content">
                            <div class="epc_chart donutchart" data-percent="76" data-bar-color="#03a9f4" data-size="135">
                                <span class="epc_chart_icon">
                                    <i class="fa fa-user"></i>
                                </span>
                            </div>
                        </div>
                        <div class="tru-card-overlay-content">
                            <div class="clearfix tru-card-overlay-header">
                                <i class="material-icons tru-icon tru-card-overlay-toggler">more_vert</i>
                                <h3>User Messages</h3>
                            </div>
                            Lorem ipsum dolor sit amet, consectetur adipisicing elit. Accusamus alias consectetur.
                        </div>
                    </div>
                </div>
            </div>
            <div class="small-3 columns">
                <div class="panel trupanel nopadding" style="min-height: 200px;">
                    <div>
                        <h6 style="padding: 15px; margin: 0; font-size: 14px;">Chart</h6>
                    </div>
                    <div class="md-switch">
                        <label>
                            <input type="checkbox">
                            <span class="lever"></span>
                        </label>
                    </div>
                    <div class="md-switch md-blue">
                        <label>
                            <input type="checkbox">
                            <span class="lever"></span>
                        </label>
                    </div>
                </div>
            </div>
            <div class="small-3 columns">
                <div class="panel trupanel nopadding" style="min-height: 200px;">
                    <div class="left">
                        <h6 style="padding: 15px; margin: 0; font-size: 14px;">Chart</h6>
                    </div>

                </div>
            </div>
            <div class="small-3 columns">
                <div class="panel trupanel nopadding" style="min-height: 200px;">
                    <div class="left">
                        <h6 style="padding: 15px; margin: 0; font-size: 14px;">Chart</h6>
                    </div>

                    <button class="snackbar" data-message="Good Job at setting this Up!">Click Me</button>

                </div>
            </div>
        </div>

    </div>
</div>



{{#contentFor 'js-plugins'}}
    <script type="text/javascript">
        require(['underscore', 'jquery', 'pages/reports', 'modules/helpers', 'countup', 'metricsgraphics', 'peity'], function(_, $, r, helpers, CountUp) {
            r.init();

            var parms = {
                full_width: true,
                height: 250,
                target: '#test',
                x_accessor: 'date',
                y_accessor: 'value',
                y_extended_ticks: true,
                show_tooltips: false,
                aggregate_rollover: true,
                transition_on_update: false,
                colors: ['#2196f3', 'red']
            };

            getData(30);
            $('#select_timespan').on('change', function() {
                var self = $(this);
                getData(self.val());
            });

            function getData(timespan) {
                $.ajax({
                            url: '/api/v1/tickets/count/days/' + timespan,
                            method: 'GET',
                            success: function(_data) {
                                parms.data = MG.convert.date(_data.data, 'date');
                                MG.data_graphic(parms);

                                var tCount = _(_data.data).reduce(function(m, x) { return m + x.value; }, 0);
                                var ticketCount = $('#ticketCount');
                                var oldTicketCount = ticketCount.text();
                                ticketCount.parents('.tru-card-content').find('span.uk-text-small').text('Total Tickets (last ' + timespan + 'd)');
                                var theAnimation = new CountUp('ticketCount', oldTicketCount, tCount, 0, 1.5);
                                theAnimation.start();

                                var closedCount = Number(_data.closedCount);
                                var closedPercent = Math.round((closedCount / tCount) * 100);

                                var textComplete = $('#text_complete');
                                var oldTextComplete = textComplete.text();
                                var completeAnimation = new CountUp('text_complete', oldTextComplete, closedPercent, 0, 1.5);
                                completeAnimation.start();

                                var pieComplete = $('#pie_complete');
                                pieComplete.text(closedPercent + '/100');
                                pieComplete.peity("donut", {
                                    height: 24,
                                    width: 24,
                                    fill: ["#29b955", "#ccc"]
                                });

                                var responseTime_text = $('#responseTime_text');
                                var responseTime_graph = $('#responseTime_graph');
                                var oldResponseTime = responseTime_text.text();
                                var responseTime = _data.ticketAvg;
                                var responseTime_animation = new CountUp('responseTime_text', oldResponseTime, responseTime, 0, 1.5);
                                responseTime_animation.start();


                                var lastUpdated = $('#lastUpdated').find('span');
                                lastUpdated.text(_data.lastUpdated);
                            }
                        })
                        .error(function(err) {
                            console.log('[trudesk:dashboard:getData] Error - ' + err);
                            setTimeout(getData, 25000);
                        });
            }


        });
    </script>
{{/contentFor}}